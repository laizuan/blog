name: Deploy blog website
on:
  push:
    branches:
      - master

env:
  SERVER_PRIVATE_KEY: ${{ secrets.SERVER_PRIVATE_KEY }}
  SERVER_HOST: ${{ secrets.SERVER_HOST }}
  USER_NAME: ${{ secrets.USER_NAME }}
  # Algolia setting
  ALGOLIA_API_KEY: ${{ secrets.ALGOLIA_API_KEY }}
  ALGOLIA_API_ID: ${{ secrets.ALGOLIA_API_ID }}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout branche
        uses: actions/checkout@master
        with:
          ref: master

      - uses: actions/setup-node@v3
        with:
          node-version: 16
          always-auth: true

      # 装依赖
      #       - name: Install & Build
      #         run: yarn

      # 打包
      #       - name: Build
      #         run: yarn docs:build

      #       # 上传打包资源
      #       - name: Deploy
      #         uses: easingthemes/ssh-deploy@v2.2.11
      #         env:
      #           SSH_PRIVATE_KEY: ${{ env.SERVER_PRIVATE_KEY }}
      #           ARGS: '-avz --delete'
      #           SOURCE: 'docs/.vitepress/dist/'
      #           REMOTE_HOST: ${{ env.SERVER_HOST }}
      #           REMOTE_USER: ${{ env.USER_NAME }}
      #           TARGET: /home/project/client/blog

      # 上传网站搜索资源
      - name: Algolia crawler creation and crawl
        uses: rxrw/algolia-index-uploader@v1
        with:
          algolia_index_id: '8TBF6K4PZU'
          algolia_index_admin_key: 'd25d40ad11d1f2831215b67015ddca25'
          algolia_index_name: 'seedltd-online-docs'
          index_path: 'docs/algolia.json'
