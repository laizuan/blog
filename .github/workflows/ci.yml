name: Deploy blog website
on:
  push:
    branches:
      - master

env:
  SERVER_PRIVATE_KEY: ${{ secrets.SERVER_PRIVATE_KEY }}
  SERVER_HOST: ${{ secrets.SERVER_HOST }}
  USER_NAME: ${{ secrets.USER_NAME }}
  # Algolia setting
  ALGOLIA_API_KEY: ${{secrets.ALGOLIA_API_KEY}}
  ALGOLIA_API_ID: ${{secrets.ALGOLIA_API_ID}}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout branche
        uses: actions/checkout@master
        with:
          ref: master

      - uses: actions/setup-node@v3
        with:
          node-version: 16
          always-auth: true

      # 装依赖
      - name: Install & Build
        run: yarn

      # 打包
#       - name: Build
#         run: yarn docs:build

#       # 上传打包资源
#       - name: Deploy
#         uses: easingthemes/ssh-deploy@v2.2.11
#         env:
#           SSH_PRIVATE_KEY: ${{ env.SERVER_PRIVATE_KEY }}
#           ARGS: '-avz --delete'
#           SOURCE: 'docs/.vitepress/dist/'
#           REMOTE_HOST: ${{ env.SERVER_HOST }}
#           REMOTE_USER: ${{ env.USER_NAME }}
#           TARGET: /home/project/client/blog

      # 上传网站搜索资源
      - name: Algolia crawler creation and crawl
        uses: algolia/algoliasearch-crawler-github-actions@v1.0.10
        with:
          crawler-user-id: ""
          crawler-api-key: ""
          algolia-app-id: ${{ env.ALGOLIA_APP_ID }}
          algolia-api-key: ${{ env.ALGOLIA_API_KEY }}
          site-url: 'http://docs.seedltd.cn'
          INDEX_NAME: 'seedltd-online-docs'
          #FILE_PATH: 'docs/algolia.json'
